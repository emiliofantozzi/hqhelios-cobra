# Sprint Status - COBRA-BMAD
# Actualizado: 2025-12-07
# Estado Actual: Epic 4 EN PROGRESO - Story 4.1 y 4.2 completadas, Story 4.3 ready-for-dev

# ============================================================
# DEFINICIONES DE ESTADO
# ============================================================
# Epic Status:
#   - backlog: Epic existe pero no iniciado
#   - contexted: Contexto t√©cnico creado (requerido antes de drafts)
#   - done: Epic completado con retrospectiva
#
# Story Status:
#   - backlog: Story solo existe en archivo de epic
#   - drafted: Story file creado con *create-story
#   - ready-for-dev: Draft aprobado
#   - in-progress: Developer trabajando
#   - review: Implementaci√≥n completa, code review pendiente
#   - done: Story completada
#
# Retrospective Status:
#   - optional: Puede completarse pero no requerido
#   - completed: Retrospectiva ejecutada

# ============================================================
# ESTADO DE DESARROLLO
# ============================================================

development_status:
  # ============================================================
  # Epic 1: Foundation Setup ‚úÖ COMPLETADO
  # ============================================================
  epic-1: done
  1-1-configurar-supabase-con-rls-multi-tenant: done
  1-2-integrar-clerk-con-custom-claims: done
  1-3-auto-registro-con-creacion-de-tenant: done
  1-4-seed-data-de-tenant-demo: done
  epic-1-retrospective: done

  # ============================================================
  # Epic 2: CRM y Gesti√≥n de Clientes ‚úÖ COMPLETADO
  # ============================================================
  epic-2: done
  2-1-crear-empresas-cliente: done
  2-2-listar-y-editar-empresas: done
  2-3-gestionar-contactos-de-empresa: done
  2-4-editar-y-desactivar-contactos: done
  2-5-crear-facturas-manualmente: done
  2-6-gestionar-estados-de-facturas: done
  2-7-importar-facturas-desde-csv: done
  2-8-dashboard-basico-con-kpis: done
  2-9-exportar-datos-a-csv: done
  epic-2-retrospective: done

  # ============================================================
  # Epic 3: Motor de Cobranzas Automatizado ‚úÖ COMPLETADO
  # ============================================================
  # Completado: 2025-12-05
  # Commit final: fe8d060
  # Retrospectiva: epic-3-retro-2025-12-05.md
  epic-3: done
  3-1-schema-de-playbooks-y-mensajes: done
  3-2-builder-de-playbooks: done
  3-3-playbooks-pre-configurados-seed: done
  3-4-schema-de-collections: done
  3-4-1-ui-consistency: done
  3-5-activar-playbook-en-factura: done
  3-6-worker-de-procesamiento-automatico: done
  3-7-control-manual-de-playbook-activo: done
  epic-3-retrospective: done

  # ============================================================
  # Epic 4: Comunicaci√≥n por Email üéØ EN PROGRESO
  # ============================================================
  # FRs: FR21, FR23, FR24 (FR22 WhatsApp ‚Üí Epic 5 per ADR-005)
  # Dependencias: Epic 3 (completado)
  # Stories: 3
  # Actualizado: 2025-12-07
  # Story 4.2 completada: Historial de mensajes con code review fixes
  # Commit: 0ecd5d4 - Incluye fixes de seguridad (tenant verification)
  epic-4: in-progress
  4-1-envio-de-emails-transaccionales: done
  4-2-historial-de-mensajes-enviados: done
  4-3-webhooks-de-delivery-status: ready-for-dev
  epic-4-retrospective: optional

  # ============================================================
  # Epic 5: Loop de Respuestas e IA
  # ============================================================
  epic-5: backlog
  5-1-captura-de-respuestas-email-n8n: backlog
  5-2-captura-de-respuestas-whatsapp-n8n: backlog
  5-3-endpoint-de-customer-response: backlog
  5-4-bandeja-de-respuestas-pendientes: backlog
  5-5-aprobar-sugerencia-de-ia: backlog
  5-6-accion-manual-override: backlog
  5-7-panel-de-contexto-completo: backlog
  epic-5-retrospective: optional

  # ============================================================
  # Epic 6: Dashboard Operativo y Analytics
  # ============================================================
  epic-6: backlog
  6-1-dashboard-operativo-completo: backlog
  6-2-exportacion-de-reportes: backlog
  6-3-notificaciones-in-app: backlog
  6-4-notificaciones-por-email: backlog
  6-5-escalamiento-manual: backlog
  epic-6-retrospective: optional

# ============================================================
# RESUMEN DE EPICS COMPLETADOS
# ============================================================
# Para referencia r√°pida - detalles completos en retrospectivas

completed_epics:
  epic-1:
    name: "Foundation Setup"
    completed: "2025-12-01"
    stories: 4
    highlights:
      - "Supabase + RLS multi-tenant"
      - "Clerk con custom claims"
      - "Auto-registro con creaci√≥n de tenant"

  epic-2:
    name: "CRM y Gesti√≥n de Clientes"
    completed: "2025-12-03"
    stories: 9
    highlights:
      - "CRUD empresas/contactos/facturas"
      - "Dashboard con 4 KPIs"
      - "Import/Export CSV"
      - "M√°quina de estados de facturas"

  epic-3:
    name: "Motor de Cobranzas Automatizado"
    completed: "2025-12-05"
    stories: 8
    highlights:
      - "Playbook Builder con drag & drop"
      - "3 playbooks pre-configurados"
      - "Collection schema con state machine"
      - "Worker autom√°tico con Redis lock"
      - "Rate limiting por tenant/contacto"
      - "UI de control manual (pause/resume/complete)"

# ============================================================
# PR√ìXIMO PASO: Story 4.3 - Webhooks de Delivery Status
# ============================================================
# Story 4.3 est√° ready-for-dev
#
# Prerequisitos completados:
#   ‚úÖ Story 4.1: Env√≠o de emails via Resend (external_message_id guardado)
#   ‚úÖ Story 4.2: Historial de mensajes (UI para ver delivery_status)
#
# Para Story 4.3 necesitas:
#   - Configurar webhook en Resend Dashboard
#   - Variable de entorno: RESEND_WEBHOOK_SECRET
#   - Librer√≠a svix para verificaci√≥n de firmas
#
# Lo que hace Story 4.3:
#   - Endpoint POST /api/webhooks/resend
#   - Mapea eventos Resend ‚Üí delivery_status
#   - Actualiza sent_messages.delivery_status en tiempo real
#   - Idempotencia y validaci√≥n de firma
#
# Referencia: docs/epics/epic-4-comunicacion.md#Story 4.3

# ===========================================
# CLERK - MOCK USER FOR PRODUCTION TESTING (PLAYWRIGHT)
# TEST EMAIL: your_email+clerk_test@example.com
# VERIFICATION CODE: 424242
# TEST PHONE NUMBER: +15555550100
# ===========================================